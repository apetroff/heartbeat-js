<!DOCTYPE html>
<html>
<head></head>
<body>
	<table style="WIDTH:100%;" class="grid-header" border="0">
		<colgroup>
			<col width="28px/">
			<col width="300px/">
			<col width="150px/">
			<col width="250px/">
			<col width="100px/">
			<col width="90px/">
		</colgroup>
		<tbody id="tbody_1">
			<tr>
				<th title=" " colspan="1" rowspan="1" class="header-cell">&nbsp;</th>
				<th title="Краткое наименование" colspan="1" rowspan="1" class="header-cell">Краткое наименование</th>
				<th title="Регион" colspan="1" rowspan="1" class="header-cell">Регион</th>
				<th title="Отрасль" colspan="1" rowspan="1" class="header-cell">Отрасль</th>
				<th title="ИНН" colspan="1" rowspan="1" class="header-cell">ИНН</th>
				<th title="ОКПО" colspan="1" rowspan="1" class="header-cell">ОКПО</th>
			</tr>
		</tbody>
	</table>
	<script>
		var listISIN = 'RU0009029540 RU0007661625 RU0009024277 RU0007288411 RU000A0JP5V6 RU000A0J2Q06 RU0008926258 RU000A0JPVJ0 RU0009046510 RU000A0JPNN9 RU0009046452 RU000A0JPKH7 RU0007661302 RU000A0JPNM1 RU0008943394 RU0009062285 RU000A0DKVS5 RU0009033591 RU000A0JKQU8 RU0007775219 RU0009062467 RU000A0DKXV5 RU0009084396 RU000A0B90N8 RU000A0HGPM9 RU000A0JNGA5 RU000A0JNG55 RU000A0JNAA8 RU000A0DQZE3 RU000A0JPFP0 RU000A0JP7F5 RU0008958863 RU000A0JPPL8 RU000A0JNUD0 RU0009028674 RU000A0HG4P4 RU0009071187 RU000A0JQU47 RU0009100291 RU0008959580 RU0006914488 RU000A0JR6A6 RU0005294775 RU0007252813 RU000A0ET7Y7 RU0009100945 RU0008081765 RU0007664942 RU0009107684 RU000A0JPGA0'.split(' ');
		var primeUrl = 'http://emitent.1prime.ru/EmitentPages/EmitentSearchResultGrid.aspx';
		var reactor = document.createElement('div');
		var renderTo = document.getElementById('tbody_1');
		
		function getXmlSer(isin) {
		
			return '<request><pageNumber>1</pageNumber><rowsOnPage>50</rowsOnPage>'
				+'<orderCondition><order/></orderCondition><forExcel>0</forExcel><forWord>0</forWord><Name></Name>'
				+'<CodeType>-1</CodeType><regionList></regionList><regionListStr></regionListStr><branchList></branchList>'
				+'<branchListStr></branchListStr><pocList></pocList><pocListStr></pocListStr><emitentTypeList>1 2 3 4</emitentTypeList>'
				+'<INN></INN><tiker></tiker><OKPO></OKPO><ISIN>'
				+ isin
				+'</ISIN><OGRN></OGRN><regNumBank></regNumBank><codeFSFR></codeFSFR><regNumStrah></regNumStrah><OKATO></OKATO>'
				+'<pocSearchType>0</pocSearchType><pocIntervalType>0</pocIntervalType><pocFromYear>2011</pocFromYear>'
				+'<pocToYear>2012</pocToYear><pocOfQ>1</pocOfQ><pocOfY>2012</pocOfY><isTrading>0</isTrading>'
				+'<showCol>ShortName Region Branch INN OKPO</showCol></request>';
		}
		
		function loadISIN(isin) {
			
			var xhr = new XMLHttpRequest();
			
			var url = encodeURI(primeUrl),
				headers = encodeURI(JSON.stringify({
					"Content-Type": "application/estyle-xml-request",
					"Origin": "http://emitent.1prime.ru",
					"Referer": "http://emitent.1prime.ru/EmitentPages/EmitentSearchResult.aspx"
				}));
			
			xhr.open('POST', 'http://collaboratoria.local/proxy/post?url='+url+'&headers='+headers, true);
			
			xhr.onreadystatechange = function (event) {  
				
				if (xhr.readyState === 4) {  
					if (xhr.status === 200) {
						reactor.innerHTML = xhr.responseText;
						var row = reactor.querySelector('tr.even-row');
						renderTo.appendChild(row);
						while (reactor.firstChild) reactor.removeChild(reactor.firstChild);
						if (listISIN.length) loadISIN(listISIN.shift());
					} else {  
						console.log("Error", xhr.statusText);  
					}
				}
			};
			
			
			xhr.send(getXmlSer(isin));
		}
		
		loadISIN(listISIN.shift());
		
	</script>
</body>
</html>